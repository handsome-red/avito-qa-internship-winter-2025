# Тест-кейсы для API микросервиса объявлений

## Введение
**Тестируемая система:** REST API микросервиса объявлений  
**URL тестового окружения:** `https://qa-internship.avito.com`  
**Метод тестирования:** Black-box  
**Особенности API:** Несоответствие документации и реализации, наличие известных багов

## Известные баги/особенности
1. POST запрос возвращает `{"status": "Сохранили объявление - <id>"}` вместо полного объекта
2. Поле в запросе: `sellerID`, в ответе: `sellerId` (разный регистр)
3. Отрицательные значения в `price` и `statistics` принимаются (должны быть 400)
4. Нулевые значения в `statistics` не принимаются (возвращает 400)
5. Формат ID: UUID v4 (36 символов)
6. Формат даты: `"2025-12-28 11:12:51.829675 +0300 +0300"`

---

## 1. Тесты создания объявления (POST /api/1/item)

### 1.1. Позитивные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-001 | Успешное создание объявления | - | 1. POST `/api/1/item` с валидными данными: `{"sellerId": <111111-999999>, "name": "Тест", "price": 1000, "statistics": {"likes": 1, "viewCount": 1, "contacts": 1}}`<br>2. Проверить ответ | Статус: 200<br>Формат ответа: `{"status": "Сохранили объявление - <uuid>"}` | [✓] |
| TC-002 | Создание с минимальными значениями | - | 1. POST с `price`: 1, `statistics`: 1,1,1 | Статус: 200, ID в ответе | [✓] |
| TC-003 | Создание с максимальными значениями | - | 1. POST с `price`: 9999999<br>2. POST с `statistics`: 9999999,9999999,9999999 | Статус: 200 или 400 (проверка ограничений) |  |
| TC-004 | Создание с длинным именем | - | 1. POST с `name`: 255 символов<br>2. POST с `name`: 1000 символов | Статус: 200 (или 400 при превышении) |  |
| TC-005 | Создание с разными типами имен | - | 1. POST с `name`: "Товар 123!@#"<br>2. POST с `name`: "Товар с пробелами"<br>3. POST с `name`: "Multi\nLine" | Статус: 200, имя сохраняется как есть |  |

### 1.2. Негативные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-006 | Отсутствие обязательного поля sellerID | - | 1. POST без поля `sellerID` | Статус: 400, сообщение: "поле sellerID обязательно" | [✓] |
| TC-007 | Отсутствие обязательного поля name | - | 1. POST без поля `name` | Статус: 400, сообщение об ошибке | [✓] |
| TC-008 | Отсутствие обязательного поля price | - | 1. POST без поля `price` | Статус: 400, сообщение об ошибке | [✓] |
| TC-009 | Отсутствие обязательного поля statistics | - | 1. POST без поля `statistics` | Статус: 400, сообщение об ошибке | [✓] |
| TC-010 | Неверный тип sellerID | - | 1. POST с `sellerID`: "не число"<br>2. POST с `sellerID`: 123.45 | Статус: 400 | [✓] |
| TC-011 | Неверный тип price | - | 1. POST с `price`: "тысяча"<br>2. POST с `price`: true | Статус: 400 | [✓] |
| TC-012 | Неверный тип в statistics | - | 1. POST с `statistics.likes`: "много"<br>2. POST с `statistics`: "invalid" | Статус: 400 | [✓] |
| TC-013 | Неполная statistics | - | 1. POST без `statistics.likes`<br>2. POST без `statistics.viewCount`<br>3. POST без `statistics.contacts` | Статус: 400 | [✓] |
| TC-014 | Дублирование ID в запросе | - | 1. POST с полным объектом, включая `id` и `createdAt` | Статус: 200, сервер игнорирует переданные `id` и `createdAt` | [✓] |

### 1.3. Тесты на баги (проверка известных проблем)
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Фактический результат |
|---|---|---|---|---|---|
| TC-015 | **БАГ:** Отрицательная цена | - | 1. POST с `price`: -100 | ❌ Статус: 400 (не должно приниматься) | [✓] Статус: 200 (баг) |
| TC-016 | **БАГ:** Отрицательная статистика | - | 1. POST с `statistics.likes`: -10<br>2. POST с `statistics.viewCount`: -5<br>3. POST с `statistics.contacts`: -1 | ❌ Статус: 400 (не должно приниматься) | [✓] Статус: 200 (баг) |
| TC-017 | **БАГ:** Нулевая статистика | - | 1. POST с `statistics.likes`: 0<br>2. POST с `statistics.viewCount`: 0<br>3. POST с `statistics.contacts`: 0 |  Статус: 200 (должно приниматься) | ❌ Статус: 400 (баг) |
| TC-018 | Несоответствие sellerID/sellerId | - | 1. POST с `sellerID` (заглавная D)<br>2. Получить созданное объявление |  В ответе должно быть `sellerId` (маленькая d) | [✓] В ответе `sellerId` (баг документации) |

---

## 2. Тесты получения объявления по ID (GET /api/1/item/{id})

### 2.1. Позитивные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-019 | Успешное получение существующего объявления | Создано объявление с ID: `{item_id}` | 1. GET `/api/1/item/{item_id}` | Статус: 200<br>Формат: `[{"id": "...", "sellerId": ..., "name": "...", "price": ..., "statistics": {...}, "createdAt": "..."}]`<br>Все поля соответствуют созданному | [✓] |
| TC-020 | Проверка структуры ответа | Создано объявление | 1. Получить объявление<br>2. Проверить типы полей | `id`: string (UUID)<br>`sellerId`: integer<br>`name`: string<br>`price`: integer<br>`statistics`: object<br>`createdAt`: string (timestamp) | [✓] |

### 2.2. Негативные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-021 | Получение несуществующего объявления | - | 1. GET с несуществующим UUID | Статус: 404 или 400 | [✓] |
| TC-022 | Некорректный формат ID | - | 1. GET с ID: "123"<br>2. GET с ID: "не-uuid"<br>3. GET с ID: "" | Статус: 400 | [✓] |
| TC-023 | Слишком длинный ID | - | 1. GET с ID: 50+ символов | Статус: 400 | [✓] |
| TC-024 | Специальные символы в ID | - | 1. GET с ID: "../../etc/passwd"<br>2. GET с ID: "<script>" | Статус: 400 |  |

---

## 3. Тесты получения объявлений продавца (GET /api/1/{sellerID}/item)

### 3.1. Позитивные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-025 | Успешное получение всех объявлений продавца | Создано 3 объявления с `sellerId`: 123456 | 1. GET `/api/1/123456/item` | Статус: 200<br>Массив из 3 объектов<br>Все `sellerId` = 123456 | [✓] |
| TC-026 | Продавец без объявлений | sellerID без объявлений | 1. GET с существующим sellerID без объявлений | Статус: 200, пустой массив `[]` | [✓] |
| TC-027 | Проверка уникальности ID в ответе | Создано 2+ объявления одним sellerID | 1. Получить все объявления продавца | Все ID в массиве уникальны | [✓] |

### 3.2. Негативные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-028 | Несуществующий sellerID | - | 1. GET с несуществующим sellerID | Статус: 400, сообщение: "передан некорректный идентификатор продавца" | [✓] |
| TC-029 | Некорректный тип sellerID | - | 1. GET с sellerID: "не число"<br>2. GET с sellerID: 123.45 | Статус: 400 | [✓] |
| TC-030 | Отрицательный sellerID | - | 1. GET с sellerID: -1 | Статус: 400 | [✓] |
| TC-031 | Слишком большой sellerID | - | 1. GET с sellerID: 1000000 (больше 999999) | Статус: 400 или 200 |  |

---

## 4. Тесты получения статистики (GET /api/1/statistic/{id}, GET /api/2/statistic/{id})

### 4.1. Позитивные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-032 | Успешное получение статистики (v1) | Создано объявление со статистикой | 1. GET `/api/1/statistic/{item_id}` | Статус: 200<br>Формат: `[{"likes": n, "viewCount": n, "contacts": n}]`<br>Значения соответствуют созданным | [✓] |
| TC-033 | Успешное получение статистики (v2) | Создано объявление со статистикой | 1. GET `/api/2/statistic/{item_id}` | Статус: 200, формат аналогичен v1 | [✓] |
| TC-034 | Сравнение v1 и v2 статистики | Создано объявление | 1. Получить статистику через v1<br>2. Получить через v2 | Данные идентичны (или v2 имеет дополнительные поля) | [✓] |

### 4.2. Негативные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-035 | Статистика несуществующего объявления | - | 1. GET с несуществующим ID | Статус: 404 или 400 | [✓] |
| TC-036 | **БАГ:** Несоответствие статусов | - | 1. GET статистики несуществующего ID | ❌ Статус: 404<br>Сообщение: статус 404 | [✓] Статус: 404<br>Сообщение: `{"status": "400"}` (баг) |
| TC-037 | Некорректный ID для статистики | - | 1. GET с ID: "invalid" | Статус: 400 | [✓] |

---

## 5. Тесты удаления объявления (DELETE /api/2/item/{id})

### 5.1. Позитивные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-038 | Успешное удаление объявления | Создано объявление | 1. DELETE `/api/2/item/{item_id}`<br>2. Попытка получить удаленное | 1. Статус: 200 (пустое тело)<br>2. Статус: 404 | [✓] |
| TC-039 | Идемпотентность удаления | Удалено объявление | 1. Повторный DELETE того же ID | Статус: 404 (или 200, если идемпотентно) | [✓] |

### 5.2. Негативные тесты
| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-040 | Удаление несуществующего объявления | - | 1. DELETE с несуществующим ID | Статус: 404 | [✓] |
| TC-041 | Некорректный ID для удаления | - | 1. DELETE с ID: "invalid" | Статус: 400, сообщение: "переданный id айтема некорректный" | [✓] |
| TC-042 | Удаление уже удаленного | Удалено объявление | 1. DELETE повторно | Статус: 404, сообщение: `{"result": {"message": "", "messages": null}, "status": "500"}` (баг) | [✓] |

---

## 6. Интеграционные/сквозные тесты

| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-043 | Полный жизненный цикл объявления | - | 1. Создать объявление (POST)<br>2. Получить по ID (GET)<br>3. Получить статистику (GET)<br>4. Получить все объявления продавца (GET)<br>5. Удалить объявление (DELETE)<br>6. Проверить удаление (GET) | Все шаги 200, кроме шага 6 (404) | [✓] |
| TC-044 | Создание нескольких объявлений одним продавцом | - | 1. Создать 3 объявления с одинаковым sellerID<br>2. Получить все объявления продавца<br>3. Удалить все объявления | 1. Все создания 200<br>2. Массив из 3 объявлений<br>3. Все удаления 200 | [✓] |
| TC-045 | Проверка целостности данных | - | 1. Создать объявление с известными данными<br>2. Получить объявление по ID<br>3. Сравнить все поля | Все поля идентичны (кроме id и createdAt, которые генерируются сервером) | [✓] |
| TC-046 | Параллельные операции | - | 1. Одновременно создать 2 объявления разными sellerID<br>2. Одновременно запросить статистику для разных объявлений | Все операции завершаются успешно, данные корректны |  |

---

## 7. Тесты безопасности

| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-047 | SQL-инъекция в name | - | 1. POST с `name`: `" OR 1=1 --`<br>2. POST с `name`: `'; DROP TABLE items; --` | Статус: 200 (имя сохраняется как строка) или 400 |  |
| TC-048 | XSS в name | - | 1. POST с `name`: `<script>alert(1)</script>`<br>2. Получить объявление | Статус: 200, имя сохраняется как есть (экранирование на стороне клиента) |  |
| TC-049 | Проверка заголовков безопасности | - | 1. Любой запрос к API<br>2. Проверить заголовки ответа | `Content-Type: application/json`<br>Нет критических уязвимостей в CORS, HSTS и т.д. |  |
| TC-050 | Большие данные (DoS) | - | 1. POST с очень большим JSON (>10MB)<br>2. POST с глубоко вложенным JSON | Статус: 400 или 413 |  |

---

## 8. Граничные и нагрузочные тесты

| ID | Название | Предусловия | Шаги | Ожидаемый результат | Статус |
|---|---|---|---|---|---|
| TC-051 | Граничные значения sellerID | - | 1. Создать с `sellerID`: 111111<br>2. Создать с `sellerID`: 999999<br>3. Создать с `sellerID`: 100000<br>4. Создать с `sellerID`: 9999999 | 1-2: Статус 200<br>3-4: Статус 200 или 400 |  |
| TC-052 | Очень большие числовые значения | - | 1. POST с `price`: 2147483647 (MAX_INT)<br>2. POST с `price`: 9223372036854775807 (MAX_BIGINT) | Статус: 200 (успешно) или 400 (переполнение) |  |
| TC-053 | Частые запросы (rate limiting) | - | 1. Отправить 10 запросов подряд на создание | Все успешны или часть 429 (слишком много запросов) |  |
| TC-054 | Долгие имена и значения | - | 1. POST с `name`: 10К символов<br>2. POST с JSON глубиной 100 уровней | Статус: 400 или 200 (с обрезанием) |  |

---

## Сводка покрытия

### По endpoint-ам:
- [✓] POST /api/1/item - 18 тест-кейсов
- [✓] GET /api/1/item/{id} - 6 тест-кейсов  
- [✓] GET /api/1/{sellerID}/item - 7 тест-кейсов
- [✓] GET /api/1/statistic/{id} - 6 тест-кейсов
- [✓] GET /api/2/statistic/{id} - включено в тесты статистики
- [✓] DELETE /api/2/item/{id} - 5 тест-кейсов
- [✓] Интеграционные - 4 тест-кейса
-  Безопасность - 4 тест-кейса
-  Граничные/нагрузочные - 4 тест-кейса

### Итого:
- **Всего тест-кейсов:** 54
- **Реализовано в pytest:** 24 теста (основная функциональность)
- **Требуют ручного тестирования:** 30 тестов (безопасность, нагрузка, граничные)
- **Известные баги:** 5 тестов помечены как баги

### Приоритеты:
1. **Высокий:** Тесты с пометкой [✓] (основная функциональность)
2. **Средний:** Тесты с пометкой  (дополнительные проверки)
3. **Низкий:** Тесты безопасности и нагрузочные (требуют специальных инструментов)

---

## Примечания для тестировщика

1. **Генерация sellerID:** Всегда использовать уникальные sellerID в диапазоне 111111-999999
2. **Очистка данных:** После тестов удалять созданные объявления
3. **Баги:** Все найденные баги зафиксированы в тест-кейсах с пометкой **БАГ**
4. **Автоматизация:** 24 основных теста уже реализованы в pytest
5. **Ручное тестирование:** Тесты безопасности и нагрузочные требуют ручного выполнения

## Формат баг-репортов

Для каждого найденного бага указать:
- **ID тест-кейса:** Например, TC-015
- **Название бага:** Короткое описание
- **Шаги воспроизведения:** Из тест-кейса
- **Ожидаемый результат:** Из тест-кейса  
- **Фактический результат:** Что происходит на самом деле
- **Серьезность:** High/Medium/Low
- **Приоритет:** P0/P1/P2/P3
- **Окружение:** Тестовое окружение
- **Дополнительно:** Скриншоты, логи, версия API